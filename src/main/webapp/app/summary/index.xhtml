<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pe="http://primefaces.org/ui/extensions"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
    <h:body>
        <ui:composition template="/WEB-INF/template.xhtml">

            <ui:define name="pageTitle">#{msg.sum_title}</ui:define>

            <ui:define name="mainpage">

                <h:outputStylesheet library="css" name="summary.css"/>
                <h:outputStylesheet library="css" name="timeline.css"/>
                <h:outputStylesheet library="primefaces" name="grid/grid.css"/>
                <h:outputScript library="primefaces" name="jquery/jquery.js" />

                <div id="summary-content">

                    <h1 class="mobileCentered">#{summaryBean.observation.name}</h1>

                    <h2 class="mobileCentered">#{msg.sum_title}</h2>

                    <div class="inline-bar mobileCentered">
                        <div class="inline-bar align-bar">
                            <div>
                                <div id="total-records" class="total"></div>
                                <div><span>#{msg.sum_totalRecordings}</span></div>
                            </div>
                            <div>
                                <div id="total-duration" class="total"></div>
                                <div><span>#{msg.sum_duration}</span></div>
                            </div>
                        </div>
                        <div class="inline-bar align-bar">
                            <div class="timeframe">
                                <div>
                                    <p:calendar id="startTime" placeholder="hh:mm:ss" size="8" widgetVar="startTimeWdgt"
                                                pattern="HH:mm:ss" timeOnly="true" mask="true"
                                                locale="#{sessionBean.locale}"
                                                value="#{summaryBean.min}"
                                                title="#{msg.sum_timeFrameTitle}">
                                        <f:validateRegex pattern="(^$|^__:__:__$|^(\d+:)?(\d+:)?\d+$)" />
                                        <p:clientValidator event="keyup"/>
                                    </p:calendar>
                                </div>
                                <div>
                                    <span>#{msg.sum_timeFrameStart}</span>
                                </div>
                            </div>
                            <div class="timeframe">
                                <div>
                                    <p:calendar id="endTime" placeholder="hh:mm:ss" size="8" widgetVar="endTimeWdgt"
                                                pattern="HH:mm:ss" timeOnly="true" mask="true"
                                                locale="#{sessionBean.locale}"
                                                value="#{summaryBean.duration}"
                                                title="#{msg.sum_timeFrameTitle}">
                                        <f:validateRegex pattern="(^$|^__:__:__$|^(\d+:)?(\d+:)?\d+$)" />
                                        <p:clientValidator event="keyup"/>
                                    </p:calendar>
                                </div>
                                <div>
                                    <span>#{msg.sum_timeFrameEnd}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="recordings-details" class="ui-fluid">
                    <h3>#{msg.sum_recordings}</h3>
                    <div class="ui-grid ui-grid-responsive-480">
                        <div class="ui-grid-row header-row">
                            <div class="ui-grid-col-5">#{msg.sum_category}</div>
                            <div class="ui-grid-col-3">#{msg.sum_count}</div>
                            <div class="ui-grid-col-3">#{msg.sum_duration}</div>
                        </div>
                    </div>
                    <div id="records" class="ui-grid ui-grid-responsive-480"/>
                </div>

                <pe:timeline id="timeline" widgetVar="timelineWdgt"
                             value="#{summaryBean.timeline}"
                             timeZone="#{timeBean.serverTimeZone}"
                             browserTimeZone="#{timeBean.userTimeZone}"
                             min="#{summaryBean.min}"
                             max="#{summaryBean.max}"
                             start="#{summaryBean.start}"
                             zoomMin="#{summaryBean.zoomMin}"
                             zoomMax="#{summaryBean.zoomMax}"
                             selectable="true"
                             zoomable="false"
                             moveable="true"
                             animate="false"
                             animateZoom="false"
                             axisOnTop="true"
                             groupsOrder="false"
                             groupsChangeable="false"
                             groupMinHeight="16"
                             editable="false"
                             timeChangeable="true"
                             showCurrentTime="false"
                             showMajorLabels="false"
                             stackEvents="false"
                             eventMarginAxis="0"
                             eventMargin="16">
                </pe:timeline>

                <div id="timelineControls" class="bottom">
                    <div>
                        <span>#{msg.sum_zoom} </span>
                        <a id="button-zoom-out" class="fa fa-search-minus" title="#{msg.sum_zoomOut}"></a>
                        <a id="button-zoom-in" class="fa fa-search-plus" title="#{msg.sum_zoomIn}"></a>
                        <a href="#summary-content"><span> #{msg.sum_backToTop}</span><span class="fa fa-chevron-circle-up"></span></a>
                    </div>
                </div>

                <p:dialog header="#{msg.dlg_saveDialogHeader}"
                          widgetVar="dlgSave"
                          position="top"
                          resizable="false"
                          responsive="true"
                          fitViewport="true"
                          styleClass="coloredButton">
                    <h:form id="saveForm" styleClass="dialog-form ui-fluid">

                        <p:selectOneButton id="select-save" valueChangeListener="#{summaryBean.saveOptionChangeListener}" value="#{summaryBean.selectedOption}">
                            <p:ajax update="@form" />
                            <f:selectItem itemLabel="#{msg.dlg_mailOption}" itemValue="mail" />
                            <f:selectItem itemLabel="#{msg.dlg_saveOption}" itemValue="save" />
                            <f:selectItem itemLabel="#{msg.dlg_downloadOption}" itemValue="download" />
                        </p:selectOneButton>

                        <p:outputPanel styleClass="login-panel" rendered="#{!summaryBean.saveOptionAllowed}">
                            <p:outputLabel value="#{msg.dlg_onlyForRegistered}"/>
                            <p:commandButton value="#{msg.head_login}" icon="fa fa-sign-in" onclick="PF('dlgLogin').show();"/>
                        </p:outputPanel>

                        <p:outputPanel rendered="#{summaryBean.saveOptionAllowed}">
                            <h:outputLabel for="input-name" value="#{msg.sum_observationName}" />
                            <p:message for="input-name" />
                            <p:inputText id="input-name" required="true" requiredMessage="#{msg.dlg_notEmpty}"
                                         value="#{summaryBean.observation.name}"
                                         validator="#{validationBean.validateShortString}"/>

                            <h:outputLabel for="input-target" value="#{msg.sum_observationTarget}" />
                            <p:message for="input-target" />
                            <p:inputText id="input-target"
                                         value="#{summaryBean.observation.target}"
                                         validator="#{validationBean.validateShortString}"/>

                            <h:outputLabel for="input-description" value="#{msg.sum_observationDescription}" />
                            <p:message for="input-description" />
                            <p:inputTextarea id="input-description"
                                             value="#{summaryBean.observation.description}"
                                             validator="#{validationBean.validateLongString}"
                                             rows="3" cols="16" autoResize="true" />

                            <p:panel rendered="#{summaryBean.sendOptionAllowed()}" styleClass="coloredButton">
                                <h:outputLabel for="input-email" value="#{msg.dlg_giveEmail}" />
                                <p:message for="input-email" />
                                <p:inputText id="input-email" required="true" requiredMessage="#{msg.dlg_notEmpty}"
                                             value="#{validationBean.email}" />
                            </p:panel>
                        </p:outputPanel>


                        <p:commandButton class="save-button" value="#{msg.dlg_send}" icon="ui-icon-check"
                                         action="#{summaryBean.sendCurrentObservation}" validateClient="true"
                                         update="@form" rendered="#{summaryBean.sendOptionAllowed()}"/>
                        <p:commandButton class="save-button" value="#{msg.dlg_save}" icon="ui-icon-check"
                                         action="#{summaryBean.saveCurrentObservation}" validateClient="true"
                                         update="@form" rendered="#{summaryBean.saveOptionAllowed()}"/>
                        <p:commandButton class="save-button" value="#{msg.dlg_download}" icon="ui-icon-check"
                                         action="#{summaryBean.downloadCurrentObservation}" validateClient="true"
                                         update="@form" rendered="#{summaryBean.downloadOptionAllowed()}"/>

                        <p:commandButton class="cancel-button" value="#{msg.dlg_cancel}" icon="ui-icon-close"
                                         onclick="PF('dlgSave').hide();"/>
                    </h:form>
                </p:dialog>

                <p:growl id="growl" widgetVar="growlWdgt" severity="info" showDetail="true" sticky="true" escape="false" />

                <h:outputScript>
                    var SummaryIndex = {
                    getObservationDuration: function () {
                    return #{summaryBean.observation.duration};
                    },
                    getMessages: function (){
                    return msg = {
                    sum_total: "#{msg.sum_total}",
                    sum_begin: "#{msg.sum_begin}",
                    sum_end: "#{msg.sum_end}",
                    sum_duration: "#{msg.sum_duration}",
                    sum_countAbr: "#{msg.sum_countAbr}",
                    dlg_confirmLeave: "#{msg.dlg_confirmLeave}"
                    };
                    },
                    };
                </h:outputScript>
                <h:outputScript library="js" name="summary.js"/>
            </ui:define>
        </ui:composition>
    </h:body>
</html>
